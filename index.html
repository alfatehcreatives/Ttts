<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoirs - Your Digital Legacy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #0a0a0c;
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                              radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }
        .sidebar-active { background: white; color: black !important; }
        .dark-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-btn { cursor: pointer; transition: all 0.2s; }
        .nav-btn:hover:not(.sidebar-active) { background: rgba(255,255,255,0.1); }
        #lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center; }
    </style>
</head>
<body class="p-3 md:p-8">

    <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-4 md:gap-6 h-full md:h-[90vh]">
        <aside class="hidden md:flex w-64 glass-panel p-6 flex-col justify-between shrink-0">
            <div>
                <div class="flex items-center gap-3 mb-10 px-2">
                    <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                        <i class="ph ph-feather text-black text-lg"></i>
                    </div>
                    <h1 class="font-bold text-xl tracking-tight text-white">Memoirs</h1>
                </div>
                <nav class="space-y-2">
                    <button onclick="showTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium sidebar-active rounded-xl">
                        <i class="ph ph-squares-four text-xl"></i> Dashboard
                    </button>
                    <button onclick="showTab('memories')" id="nav-memories" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl">
                        <i class="ph ph-book-open text-xl"></i> Memories
                    </button>
                    <button onclick="showTab('dates')" id="nav-dates" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl">
                        <i class="ph ph-calendar text-xl"></i> Imp. Dates
                    </button>
                    <button onclick="showTab('media')" id="nav-media" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl">
                        <i class="ph ph-image text-xl"></i> Media
                    </button>
                </nav>
            </div>
            <p class="text-[10px] text-white/40 px-4" id="sync-status">Connecting...</p>
        </aside>

        <main class="flex-1 flex flex-col gap-6 overflow-hidden">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl md:text-2xl font-bold">Memory Vault</h2>
                    <p class="text-white/50 text-xs md:text-sm">Auto-syncing to cloud</p>
                </div>
                <button onclick="openModal()" class="bg-white text-black px-6 py-2.5 rounded-full text-sm font-bold flex items-center gap-2 hover:scale-105 transition active:scale-95">
                    <i class="ph ph-plus"></i> Capture
                </button>
            </header>

            <div id="tab-dashboard" class="tab-content active h-full overflow-y-auto pr-2">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="dark-card p-6">
                        <span class="text-[10px] text-white/40 uppercase tracking-widest">Total Sync</span>
                        <h3 class="text-4xl font-bold mt-2" id="stat-memories">0</h3>
                        <div class="flex gap-2 mt-6">
                            <div class="bg-white/5 p-3 rounded-xl flex-1 text-center">
                                <p class="text-[9px] text-white/40">VAULT</p>
                                <p class="font-bold" id="count-vault">0</p>
                            </div>
                            <div class="bg-white/5 p-3 rounded-xl flex-1 text-center">
                                <p class="text-[9px] text-white/40">MEDIA</p>
                                <p class="font-bold" id="count-media">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel p-6 flex flex-col col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-sm">Milestones</h4>
                            <button onclick="addMilestone()" class="text-white/40 hover:text-white"><i class="ph ph-plus"></i></button>
                        </div>
                        <div class="space-y-3" id="mini-milestones"></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-6">
                        <h4 class="font-bold text-sm mb-4">Upcoming</h4>
                        <div class="space-y-3" id="dash-dates"></div>
                    </div>
                    <div class="glass-panel p-6">
                        <h4 class="font-bold text-sm mb-4">Recent Gallery</h4>
                        <div class="grid grid-cols-3 gap-2" id="dash-media"></div>
                    </div>
                </div>
            </div>

            <div id="tab-memories" class="tab-content h-full overflow-y-auto">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="memories-list"></div>
            </div>
            <div id="tab-dates" class="tab-content h-full overflow-y-auto">
                <div class="glass-panel p-6" id="full-dates-list"></div>
            </div>
            <div id="tab-media" class="tab-content h-full overflow-y-auto">
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4" id="media-gallery"></div>
            </div>
        </main>
    </div>

    <div id="captureModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-lg p-8 shadow-2xl">
            <h3 class="text-xl font-bold mb-6">New Entry</h3>
            <form id="memoryForm" class="space-y-4">
                <input type="text" id="m-title" placeholder="Title" required class="w-full bg-white/5 border border-white/10 px-4 py-3 rounded-xl outline-none focus:border-white/40">
                <input type="text" id="m-content" placeholder="Link or Description" class="w-full bg-white/5 border border-white/10 px-4 py-3 rounded-xl outline-none focus:border-white/40">
                <div class="grid grid-cols-2 gap-4">
                    <select id="m-type" class="bg-white/5 border border-white/10 px-4 py-3 rounded-xl outline-none">
                        <option value="memories">Memory</option>
                        <option value="dates">Date</option>
                        <option value="media">Media</option>
                    </select>
                    <input type="date" id="m-date" class="bg-white/5 border border-white/10 px-4 py-3 rounded-xl outline-none">
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeModal()" class="flex-1 py-3 text-white/50 hover:text-white">Cancel</button>
                    <button type="submit" class="flex-2 bg-white text-black px-8 py-3 rounded-xl font-bold">Save to Cloud</button>
                </div>
            </form>
        </div>
    </div>

    <div id="lightbox" onclick="this.style.display='none'">
        <img id="lightboxImg" src="" class="max-w-[90%] max-h-[90%] rounded-xl">
    </div>

    <script>
        const config = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'memoirs-default';
        
        firebase.initializeApp(config);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let appData = { memories: [], dates: [], media: [], milestones: [] };
        let userId = null;

        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await auth.signInWithCustomToken(__initial_auth_token);
                } else {
                    await auth.signInAnonymously();
                }
                return;
            }
            userId = user.uid;
            setupSync();
        });

        function setupSync() {
            const path = `artifacts/${appId}/users/${userId}/data/store`;
            db.doc(path).onSnapshot((snap) => {
                if (snap.exists) {
                    appData = snap.data();
                    render();
                    document.getElementById('sync-status').innerText = "Cloud Synced";
                } else {
                    db.doc(path).set(appData);
                }
            });
        }

        async function save() {
            if (!userId) return;
            await db.doc(`artifacts/${appId}/users/${userId}/data/store`).set(appData);
        }

        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('sidebar-active'));
            document.getElementById(`tab-${id}`).classList.add('active');
            document.getElementById(`nav-${id}`).classList.add('sidebar-active');
        };

        window.openModal = () => document.getElementById('captureModal').classList.remove('hidden');
        window.closeModal = () => document.getElementById('captureModal').classList.add('hidden');

        document.getElementById('memoryForm').onsubmit = async (e) => {
            e.preventDefault();
            const type = document.getElementById('m-type').value;
            appData[type].push({
                id: Date.now(),
                title: document.getElementById('m-title').value,
                content: document.getElementById('m-content').value,
                url: document.getElementById('m-content').value,
                date: document.getElementById('m-date').value || new Date().toISOString().split('T')[0]
            });
            await save();
            closeModal();
            e.target.reset();
        };

        window.deleteItem = async (type, id) => {
            appData[type] = appData[type].filter(i => i.id !== id);
            await save();
        };

        window.addMilestone = async () => {
            const text = prompt("Milestone:");
            if(text) { appData.milestones.push({id:Date.now(), text, completed:false}); await save(); }
        };

        window.toggleMilestone = async (id) => {
            const m = appData.milestones.find(i => i.id === id);
            if(m) { m.completed = !m.completed; await save(); }
        };

        function render() {
            document.getElementById('stat-memories').innerText = (appData.memories?.length || 0) + (appData.media?.length || 0);
            document.getElementById('count-vault').innerText = appData.memories?.length || 0;
            document.getElementById('count-media').innerText = appData.media?.length || 0;

            document.getElementById('mini-milestones').innerHTML = (appData.milestones || []).map(m => `
                <div class="flex items-center gap-3 cursor-pointer p-1" onclick="toggleMilestone(${m.id})">
                    <i class="${m.completed ? 'ph-fill ph-check-circle text-green-400' : 'ph ph-circle text-white/20'}"></i>
                    <span class="text-sm ${m.completed ? 'line-through text-white/30' : ''}">${m.text}</span>
                </div>
            `).join('');

            document.getElementById('memories-list').innerHTML = (appData.memories || []).map(m => `
                <div class="glass-panel p-5 group relative">
                    <button onclick="deleteItem('memories', ${m.id})" class="absolute top-4 right-4 text-white/20 hover:text-red-400"><i class="ph ph-trash"></i></button>
                    <h5 class="font-bold mb-1">${m.title}</h5>
                    <p class="text-xs text-white/50 truncate">${m.content}</p>
                    <div class="mt-4 flex justify-between items-center">
                        <span class="text-[9px] text-white/20 font-bold uppercase tracking-widest">${m.date}</span>
                        <a href="${m.content}" target="_blank" class="text-xs text-white/60 hover:text-white underline">Open Link</a>
                    </div>
                </div>
            `).join('');

            document.getElementById('media-gallery').innerHTML = (appData.media || []).map(m => `
                <div class="aspect-square glass-panel overflow-hidden relative group">
                    <img src="${m.url}" class="w-full h-full object-cover cursor-zoom-in" onclick="document.getElementById('lightboxImg').src='${m.url}'; document.getElementById('lightbox').style.display='flex'">
                    <button onclick="deleteItem('media', ${m.id})" class="absolute top-2 right-2 bg-black/50 p-2 rounded-full opacity-0 group-hover:opacity-100 transition"><i class="ph ph-trash"></i></button>
                </div>
            `).join('');

            document.getElementById('dash-dates').innerHTML = (appData.dates || []).slice(0, 3).map(d => `
                <div class="flex items-center gap-4 bg-white/5 p-3 rounded-xl">
                    <div class="text-center bg-white/10 px-2 py-1 rounded text-[10px] font-bold">
                        <div>${new Date(d.date).toLocaleString('default', {month:'short'})}</div>
                        <div class="text-lg">${new Date(d.date).getDate()}</div>
                    </div>
                    <span class="font-medium text-sm">${d.title}</span>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
